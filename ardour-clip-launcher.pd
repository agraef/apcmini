#N canvas 743 315 490 491 12;
#X declare -path lib;
#X obj 20 390 udpsend;
#X obj 20 419 tgl 15 0 connected empty connected 17 7 0 10 #fcfcfc
#000000 #000000 1 1;
#X obj 20 173 packOSC;
#N canvas 1040 369 450 394 connect 0;
#X msg 40 260 disconnect;
#X obj 40 110 unpack s f;
#X symbolatom 40 170 16 0 0 0 - - -, f 16;
#X floatatom 170 169 5 0 0 0 - - -, f 5;
#X msg 40 230 connect \$1 \$2;
#X obj 40 197 pack s f;
#X obj 100 80 t b b;
#X obj 40 10 inlet;
#X obj 40 330 outlet;
#X obj 190 150 tgl 15 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000 1 1;
#X msg 262 116 set 1;
#X obj 230 170 sel 1 0;
#X obj 40 80 t a b b;
#X obj 200 10 inlet;
#X connect 0 0 8 0;
#X connect 1 0 2 0;
#X connect 1 1 3 0;
#X connect 2 0 5 0;
#X connect 3 0 5 1;
#X connect 4 0 8 0;
#X connect 5 0 4 0;
#X connect 6 0 2 0;
#X connect 6 1 3 0;
#X connect 7 0 12 0;
#X connect 9 0 11 0;
#X connect 10 0 9 0;
#X connect 11 0 6 0;
#X connect 11 1 0 0;
#X connect 12 0 1 0;
#X connect 12 1 10 0;
#X connect 12 2 0 0;
#X connect 13 0 9 0;
#X coords 0 -1 1 1 175 47 1 37 147;
#X restore 20 330 pd connect;
#X obj 19 225 tgl 15 1 empty empty browse 17 7 0 10 #fcfcfc #000000
#000000 1 1;
#X obj 20 250 oscbrowser;
#X obj 180 113 unpackOSC;
#X obj 200 150 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X obj 180 80 udpreceive 8000;
#X obj 261 150 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X text 281 150 init banks;
#X obj 220 220 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X msg 220 244 0;
#X obj 261 220 spigot;
#X obj 261 249 print osc;
#X obj 321 190 tgl 15 1 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000 0 1;
#X obj 20 450 declare -path lib;
#X obj 240 290 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X obj 260 310 midi-input;
#X obj 240 410 midi-output;
#X obj 240 379 t a a;
#X obj 240 350 apcmini;
#X obj 20 40 tgl 25 0 empty play play 29 7 0 10 #028725 #000000 #000000
0 1;
#X obj 101 40 bng 25 250 50 0 empty sync sync 30 8 0 10 #de05fa #000000
#000000;
#N canvas 612 393 427 262 transport 0;
#X msg 180 150 /set_surface/feedback 32768;
#X msg 20 140 /transport_stop 1;
#X msg 43 106 /transport_play 1;
#X obj 20 70 sel 0 1;
#X obj 20 30 inlet;
#X obj 180 30 inlet;
#X obj 240 30 r connected;
#X obj 240 59 change;
#X obj 240 88 sel 1;
#X obj 240 117 s sync;
#X obj 20 210 s oscout;
#X text 90 70 play/stop;
#X text 180 180 ask Ardour to update the grid and bank status, f 27
;
#X connect 0 0 10 0;
#X connect 1 0 10 0;
#X connect 2 0 10 0;
#X connect 3 0 1 0;
#X connect 3 1 2 0;
#X connect 4 0 3 0;
#X connect 5 0 0 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 8 0 9 0;
#X restore 20 80 pd transport;
#X obj 20 130 r oscout;
#N canvas 1148 489 450 300 apc-init 0;
#X msg 30 150 model;
#X obj 30 90 loadbang;
#X obj 30 119 del 500;
#X obj 30 270 outlet;
#X msg 203 210 assign 1;
#X obj 180 93 r connected;
#X obj 180 122 change;
#X msg 180 180 assign 0 \, banks 0 0 0 0;
#X obj 180 151 sel 0 1;
#X text 20 10 At startup \, try to detect the apcmini model. Also \,
when connecting to Ardour \, assign the faders to volume. When the
connection to Ardour is lost \, clear the assign and bank buttons.
;
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 2 0 0 0;
#X connect 4 0 3 0;
#X connect 5 0 6 0;
#X connect 6 0 8 0;
#X connect 7 0 3 0;
#X connect 8 0 7 0;
#X connect 8 1 4 0;
#X restore 350 330 pd apc-init;
#N canvas 521 315 712 615 osc-input 0;
#X obj 40 20 inlet;
#X obj 40 79 routeOSC /trigger_grid;
#X obj 40 108 routeOSC /bank;
#X obj 40 137 unpack f f f f;
#X floatatom 40 166 5 0 0 0 - - -, f 5;
#X floatatom 82 166 5 0 0 0 - - -, f 5;
#X floatatom 124 166 5 0 0 0 - - -, f 5;
#X floatatom 166 166 5 0 0 0 - - -, f 5;
#X text 40 190 #cols coloffs #rows rowoffs;
#X obj 40 380 routeOSC /0/state /1/state /2/state /3/state /4/state
/5/state /6/state /7/state;
#X obj 408 580 outlet;
#X obj 40 440 state 0;
#X obj 86 465 state 1;
#X obj 132 440 state 2;
#X obj 178 465 state 3;
#X obj 224 440 state 4;
#X obj 270 465 state 5;
#X obj 316 440 state 6;
#X obj 362 465 state 7;
#X obj 290 300 inlet;
#X obj 290 329 t b b b b b b b b;
#X obj 280 21 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000;
#X obj 280 45 t b b;
#X obj 280 101 del 3000;
#X msg 312 71 stop;
#X obj 280 130 outlet;
#X text 360 51 these messages come regularly \, so we can use them
to check whether our connection to Ardour is still alive, f 26;
#X text 340 300 2nd inlet: initialize the state of all pads;
#X obj 200 300 loadbang;
#X text 280 530 everything else gets passed through unchanged for testing
purposes;
#X obj 40 49 t a b;
#X text 440 380 pad state feedback per track / column;
#X text 240 180 feedback for bank switching;
#X obj 40 220 bank left right;
#X obj 170 220 bank up down;
#X obj 40 249 pack f f f f;
#X obj 40 580 outlet;
#X msg 40 278 banks \$3 \$4 \$1 \$2;
#X connect 0 0 30 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 2 1 9 0;
#X connect 3 0 4 0;
#X connect 3 1 5 0;
#X connect 3 2 6 0;
#X connect 3 3 7 0;
#X connect 4 0 33 0;
#X connect 5 0 33 1;
#X connect 6 0 34 0;
#X connect 7 0 34 1;
#X connect 9 0 11 0;
#X connect 9 1 12 0;
#X connect 9 2 13 0;
#X connect 9 3 14 0;
#X connect 9 4 15 0;
#X connect 9 5 16 0;
#X connect 9 6 17 0;
#X connect 9 7 18 0;
#X connect 9 8 10 0;
#X connect 11 0 36 0;
#X connect 12 0 36 0;
#X connect 13 0 36 0;
#X connect 14 0 36 0;
#X connect 15 0 36 0;
#X connect 16 0 36 0;
#X connect 17 0 36 0;
#X connect 18 0 36 0;
#X connect 19 0 20 0;
#X connect 20 0 11 1;
#X connect 20 1 12 1;
#X connect 20 2 13 1;
#X connect 20 3 14 1;
#X connect 20 4 15 1;
#X connect 20 5 16 1;
#X connect 20 6 17 1;
#X connect 20 7 18 1;
#X connect 21 0 22 0;
#X connect 22 0 23 0;
#X connect 22 1 24 0;
#X connect 23 0 25 0;
#X connect 24 0 23 0;
#X connect 28 0 20 0;
#X connect 30 0 1 0;
#X connect 30 1 21 0;
#X connect 33 0 35 0;
#X connect 33 1 35 1;
#X connect 34 0 35 2;
#X connect 34 1 35 3;
#X connect 35 0 37 0;
#X connect 37 0 36 0;
#X restore 180 180 pd osc-input;
#N canvas 761 277 683 588 osc-output 0;
#X obj 300 410 route 9;
#X msg 300 439 /master/fader \$1;
#X msg 300 472 /strip/fader/\$1 \$2;
#X obj 300 540 s oscout;
#X obj 440 410 route 9;
#X msg 440 439 /master/pan_stereo_position \$1;
#X msg 440 472 /strip/pan_stereo_position/\$1 \$2;
#X msg 300 130 -8;
#X msg 340 130 8;
#X msg 300 190 -8;
#X msg 340 190 8;
#X msg 300 160 /tbank_step_route \$1;
#X msg 300 220 /tbank_step_row \$1;
#X msg 94 270 /trigger_stop_all 0;
#X msg 40 190 /trigger_cue_row \$1;
#X obj 40 470 s oscout;
#X obj 80 311 t f f;
#X obj 80 340 mod 8;
#X floatatom 80 369 5 0 0 0 - - -, f 5;
#X floatatom 140 369 5 0 0 0 - - -, f 5;
#X obj 140 340 expr 7 - int($f1 / 8);
#X obj 80 397 pack f f;
#X msg 80 430 /trigger_bang \$1 \$2;
#X floatatom 40 160 5 0 0 0 - - -, f 5;
#X obj 40 30 inlet;
#X msg 40 230 /trigger_stop \$1 0;
#X obj 300 320 unpack f f;
#X obj 300 349 + 1;
#X obj 300 378 pack f f;
#X obj 300 260 s oscout;
#X obj 440 320 unpack f f;
#X obj 440 349 + 1;
#X obj 440 378 pack f f;
#X obj 368 349 / 127;
#X obj 508 349 / 127;
#X obj 40 80 route scene pad vol pan bank-up bank-down bank-left bank-right
stop stop-all solo mute, f 87;
#X obj 470 230 switches solo;
#X obj 470 259 outlet;
#X obj 530 200 switches mute;
#X text 460 120 These needed special treatment \, since apcmini doesn't
manage these states \, and apparently Ardour doesn't send any feedback
either \, so we maintain the state of those switches here and also
provide feedback for the apcmini object.;
#X connect 0 0 1 0;
#X connect 0 1 2 0;
#X connect 1 0 3 0;
#X connect 2 0 3 0;
#X connect 4 0 5 0;
#X connect 4 1 6 0;
#X connect 5 0 3 0;
#X connect 6 0 3 0;
#X connect 7 0 11 0;
#X connect 8 0 11 0;
#X connect 9 0 12 0;
#X connect 10 0 12 0;
#X connect 11 0 29 0;
#X connect 12 0 29 0;
#X connect 13 0 15 0;
#X connect 14 0 15 0;
#X connect 16 0 17 0;
#X connect 16 1 20 0;
#X connect 17 0 18 0;
#X connect 18 0 21 0;
#X connect 19 0 21 1;
#X connect 20 0 19 0;
#X connect 21 0 22 0;
#X connect 22 0 15 0;
#X connect 23 0 14 0;
#X connect 24 0 35 0;
#X connect 25 0 15 0;
#X connect 26 0 27 0;
#X connect 26 1 33 0;
#X connect 27 0 28 0;
#X connect 28 0 0 0;
#X connect 30 0 31 0;
#X connect 30 1 34 0;
#X connect 31 0 32 0;
#X connect 32 0 4 0;
#X connect 33 0 28 1;
#X connect 34 0 32 1;
#X connect 35 0 23 0;
#X connect 35 1 16 0;
#X connect 35 2 26 0;
#X connect 35 3 30 0;
#X connect 35 4 9 0;
#X connect 35 5 10 0;
#X connect 35 6 7 0;
#X connect 35 7 8 0;
#X connect 35 8 25 0;
#X connect 35 9 13 0;
#X connect 35 10 36 0;
#X connect 35 11 38 0;
#X connect 36 0 37 0;
#X connect 38 0 37 0;
#X restore 330 410 pd osc-output;
#X connect 0 0 1 0;
#X connect 2 0 0 0;
#X connect 3 0 0 0;
#X connect 4 0 5 0;
#X connect 5 0 3 0;
#X connect 6 0 7 0;
#X connect 6 0 27 0;
#X connect 8 0 6 0;
#X connect 9 0 27 1;
#X connect 11 0 12 0;
#X connect 12 0 3 1;
#X connect 13 0 14 0;
#X connect 15 0 13 1;
#X connect 17 0 21 0;
#X connect 18 0 21 0;
#X connect 20 0 19 0;
#X connect 20 1 28 0;
#X connect 21 0 20 0;
#X connect 22 0 24 0;
#X connect 23 0 24 1;
#X connect 25 0 2 0;
#X connect 26 0 21 0;
#X connect 27 0 21 0;
#X connect 27 1 11 0;
#X connect 27 2 13 0;
#X connect 28 0 21 0;
